<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Model-Based Rendering &mdash; Ren&#39;Py Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=c659a740" />
      <link rel="stylesheet" type="text/css" href="_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="_static/dark_mode_css/dark.css?v=70edf1c7" />

  
    <link rel="canonical" href="https://www.renpy.org/doc/html/model.html" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=9b928e36"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/dark_mode_js/default_light.js?v=c2e647ce"></script>
        <script src="_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Other Functions and Variables" href="other.html" />
    <link rel="prev" title="Matrix" href="matrix.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

<a href="https://www.renpy.org/" style="margin-bottom: 0">Ren'Py Visual Novel Engine
<img src="_static/navbar-logo.png" alt="Logo" style="width: 93px; height: 100px; border-radius: 0; margin: 0 auto; padding: 0; margin-top: 5px; background-color: unset;" />
</a>

<a href="index.html" style="margin-bottom: 0px">8.5.0 Documentation</a>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">GUI Customization Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Ren'Py Language</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="language_basics.html">Language Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="label.html">Labels &amp; Control Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogue.html">Dialogue and Narration</a></li>
<li class="toctree-l1"><a class="reference internal" href="displaying_images.html">Displaying Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="menus.html">In-Game Menus</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">Python Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="conditional.html">Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="audio.html">Audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="audio_filters.html">Audio Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="movie.html">Movie</a></li>
<li class="toctree-l1"><a class="reference internal" href="voice.html">Voice</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Text, Displayables, Transforms, and Transitions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="text.html">Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="translation.html">Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="displayables.html">Displayables</a></li>
<li class="toctree-l1"><a class="reference internal" href="transforms.html">Transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="transform_properties.html">Transform Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="transitions.html">Transitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="matrixcolor.html">Matrixcolor</a></li>
<li class="toctree-l1"><a class="reference internal" href="layeredimage.html">Layered Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="3dstage.html">3D Stage</a></li>
<li class="toctree-l1"><a class="reference internal" href="live2d.html">Live2D Cubism</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Customizing Ren'Py</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="style.html">Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="style_properties.html">Style Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="screens.html">Screens and Screen Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="screen_actions.html">Screen Actions, Values, and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="screen_special.html">Special Screen Names</a></li>
<li class="toctree-l1"><a class="reference internal" href="screen_optimization.html">Screen Language Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="preferences.html">Preference Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="store_variables.html">Store Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="mouse.html">Custom Mouse Cursors</a></li>
<li class="toctree-l1"><a class="reference internal" href="textshaders.html">Text Shaders</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="launcher.html">Launcher</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_tools.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="director.html">Interactive Director</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Functionality</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="nvl_mode.html">NVL-Mode Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="bubble.html">Speech Bubbles</a></li>
<li class="toctree-l1"><a class="reference internal" href="input.html">Text Input</a></li>
<li class="toctree-l1"><a class="reference internal" href="side_image.html">Side Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="rooms.html">Image Gallery, Music Room, and Replay Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="drag_drop.html">Drag and Drop</a></li>
<li class="toctree-l1"><a class="reference internal" href="sprites.html">Sprites</a></li>
<li class="toctree-l1"><a class="reference internal" href="keymap.html">Customizing the Keymap</a></li>
<li class="toctree-l1"><a class="reference internal" href="achievement.html">Achievements</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Dialogue History</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple.html">Multiple Character Dialogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="splashscreen_presplash.html">Splashscreen and Presplash</a></li>
<li class="toctree-l1"><a class="reference internal" href="lifecycle.html">Lifecycle of a Ren'Py game</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python and Ren'Py</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="statement_equivalents.html">Statement Equivalents</a></li>
<li class="toctree-l1"><a class="reference internal" href="save_load_rollback.html">Saving, Loading, and Rollback</a></li>
<li class="toctree-l1"><a class="reference internal" href="persistent.html">Persistent Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui_advanced.html">Advanced GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="screen_python.html">Screens and Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="cdd.html">Creator-Defined Displayables</a></li>
<li class="toctree-l1"><a class="reference internal" href="cds.html">Creator-Defined Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_text_tags.html">Custom Text Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="character_callbacks.html">Character Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_python.html">File Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="color_class.html">Color Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="matrix.html">Matrix</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Model-Based Rendering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#models-renders-and-drawing-operations">Models, Renders, and Drawing Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#where-models-are-created">Where Models are Created</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shader-program-generation">Shader Program Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-custom-shader">Creating a Custom Shader</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#renpy.register_shader"><code class="docutils literal notranslate"><span class="pre">renpy.register_shader()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#shader-part-local-variables">Shader Part Local Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transforms-and-model-based-rendering">Transforms and Model-Based Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="#blend-functions">Blend Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#float-sample-and-vector-uniforms">Float, Sample, and Vector Uniforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#matrix-uniforms">Matrix Uniforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#attributes">Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gl-properties">GL Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gltfmodel-displayable">GLTFModel Displayable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#GLTFModel"><code class="docutils literal notranslate"><span class="pre">GLTFModel</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-displayable">Model Displayable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Model"><code class="docutils literal notranslate"><span class="pre">Model</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Model.child"><code class="docutils literal notranslate"><span class="pre">Model.child()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Model.grid_mesh"><code class="docutils literal notranslate"><span class="pre">Model.grid_mesh()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Model.property"><code class="docutils literal notranslate"><span class="pre">Model.property()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Model.shader"><code class="docutils literal notranslate"><span class="pre">Model.shader()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Model.texture"><code class="docutils literal notranslate"><span class="pre">Model.texture()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Model.uniform"><code class="docutils literal notranslate"><span class="pre">Model.uniform()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-displayable-examples">Model Displayable Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#animated-shaders">Animated Shaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shader-parts">Shader Parts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="other.html">Other Functions and Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="ren_py.html">_ren.py Files - Ren'Py in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="fetch.html">HTTPS/HTTP Fetch</a></li>
<li class="toctree-l1"><a class="reference internal" href="screenshot.html">Screenshots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Building, Updating, and Other Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="android.html">Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="ios.html">iOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="web.html">Web / HTML5</a></li>
<li class="toctree-l1"><a class="reference internal" href="chromeos.html">Chrome OS/Chromebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="raspi.html">Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="iap.html">In-App Purchasing</a></li>
<li class="toctree-l1"><a class="reference internal" href="updater.html">HTTPS/HTTP Updater</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloader.html">Downloader for Large Games on Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="gesture.html">Gestures</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">End-User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems.html">Dealing with Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment_variables.html">Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="self_voicing.html">Self-Voicing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Library and Tool Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="template_projects.html">Template Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Engine Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="editor.html">Text Editor Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="skins.html">Skins</a></li>
<li class="toctree-l1"><a class="reference internal" href="translating_renpy.html">Translating Ren'Py</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Changes, License, and Credits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog (Ren'Py 7.x-)</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog6.html">Changelog (Ren'Py 6.11 - 6.99)</a></li>
<li class="toctree-l1"><a class="reference internal" href="incompatible.html">Incompatible Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="sponsors.html">Ren'Py Development Sponsors</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ren'Py Visual Novel Engine</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Model-Based Rendering</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/renpy/renpy/blob/master/sphinx/source/model.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="model-based-rendering">
<span id="model"></span><h1>Model-Based Rendering<a class="headerlink" href="#model-based-rendering" title="Link to this heading"></a></h1>
<p>While Ren'Py is primarily used with two dimensional rectangular images that
are common in visual novels, underneath the hood it has a model-based renderer
intended to to take advantage of features found in modern GPUs. This allows
for a number of visual effects that would not otherwise be possible.</p>
<p>As a warning, this is one of the most advanced features available in Ren'Py.
In many cases, it's not necessary to understand how model-based rendering
works behind the scenes - features like <a class="reference internal" href="transform_properties.html#transform-property-matrixcolor"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">matrixcolor</span></code></a> and Live2D support
can be used without understanding how Model-Based rendering works, and more
such features will be added to the understanding. This documentation is
intended for very advanced creators, and for developers looking to add
to Ren'Py itself.</p>
<p>Model-Based Rendering is one of the most advanced features in Ren'Py, and
this documentation may be hard to understand without first looking at the
OpenGL, OpenGL ES, GLSL, and GLSL ES manual. What's more, since there are
portions of the models that are passed directly to your GPU drivers, which
may accept erroneous inputs, it's important to check on multiple kinds of
hardware.</p>
<section id="models-renders-and-drawing-operations">
<h2>Models, Renders, and Drawing Operations<a class="headerlink" href="#models-renders-and-drawing-operations" title="Link to this heading"></a></h2>
<p>The fundamental thing that Ren'Py draws to the screen is a Model. A model
consists of the following things:</p>
<ul class="simple">
<li><p>A Mesh of one or more triangles. A triangle consists of
three vertices (corners), each of which contains a position in two or
three-dimensional space, and may contain additional information, most
commonly texture coordinates.</p></li>
<li><p>Zero or more textures, with the precise number allowed being limited by the
GPUs your game can run on. All GPUs should support at least three textures
per model. A texture is a rectangle containing image data that's been loaded
on the GPU, either directly or using a render-to-texture operation.</p></li>
<li><p>A list of shader part names. Ren'Py uses these shader parts to create shaders,
which are programs that are run on the GPU to render the model. Shader part
names can be prefixed with a &quot;-&quot; to prevent that shader part from being used.</p></li>
<li><p>Uniform values. A uniform is additional data that is the same throughout the
model. For example, when a model represents a solid color, the color is a
uniform.</p></li>
<li><p>GL properties. GL properties are flags that further control how things
are rendered, such as the minification/magnification modes and the
color mask.</p></li>
</ul>
<p>As Ren'Py usually draws more than one thing to the screen, it creates a
tree of <code class="xref py py-class docutils literal notranslate"><span class="pre">Render</span></code> objects. These Render objects may have Models or
other Renders as children. (A Render object can also be turned into a Model.
as described below.) A Render contains:</p>
<ul class="simple">
<li><p>A list of children, including a 2-dimensional offset that is applied to
each child.</p></li>
<li><p>A <a class="reference internal" href="matrix.html#Matrix" title="Matrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">Matrix</span></code></a> that describes how the children are transformed in
three-dimensional space.</p></li>
<li><p>Lists of shader part names, uniforms, and GL properties that are applied
to the Models when being drawn.</p></li>
<li><p>Flags that determine if the drawable-space clipping polygon should be
updated.</p></li>
</ul>
<p>Ren'Py draws the screen by performing a depth-first walk through the tree of
Renders, until a Model is encountered. During this walk, Ren'Py updates a
matrix transforming the location of the Model, a clipping polygon, and
lists of shader parts, uniforms, and GL properties. When a Model is encountered
as part of this walk, the appropriate shader program is activated on the GPU,
all information is transferred, and a drawing operation occurs.</p>
</section>
<section id="where-models-are-created">
<h2>Where Models are Created<a class="headerlink" href="#where-models-are-created" title="Link to this heading"></a></h2>
<p>Ren'Py creates Models automatically as part of its normal operation.
The main reason to understand where models are created is that models
correspond to drawing operations, and hence are the units that shaders
are applied to.</p>
<dl>
<dt>Images and Image Manipulators</dt><dd><p>These create a model with a mesh containing two triangles that cover
the rectangle of the image. The mesh contains texture coordinates.
The model uses the &quot;renpy.texture&quot; shader.</p>
</dd>
<dt><a class="reference internal" href="displayables.html#Solid" title="Solid"><code class="xref py py-func docutils literal notranslate"><span class="pre">Solid()</span></code></a></dt><dd><p>The Solid displayable creates a mesh containing two triangles, and no
texture coordinates. The model uses the &quot;renpy.solid&quot; shader,
with the color placed in the <code class="docutils literal notranslate"><span class="pre">u_renpy_solid_color</span></code> uniform.</p>
</dd>
<dt><a class="reference internal" href="transitions.html#Dissolve" title="Dissolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">Dissolve()</span></code></a>, <a class="reference internal" href="transitions.html#ImageDissolve" title="ImageDissolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">ImageDissolve()</span></code></a>, <a class="reference internal" href="transitions.html#AlphaDissolve" title="AlphaDissolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">AlphaDissolve()</span></code></a>, <a class="reference internal" href="transitions.html#Pixellate" title="Pixellate"><code class="xref py py-func docutils literal notranslate"><span class="pre">Pixellate()</span></code></a>, <a class="reference internal" href="displayables.html#AlphaMask" title="AlphaMask"><code class="xref py py-func docutils literal notranslate"><span class="pre">AlphaMask()</span></code></a>, <a class="reference internal" href="displayables.html#Flatten" title="Flatten"><code class="xref py py-func docutils literal notranslate"><span class="pre">Flatten()</span></code></a></dt><dd><p>Each of these transforms and displayables creates a Model with a mesh,
shaders, and uniforms as is needed for its purposes.</p>
</dd>
<dt>Live2D</dt><dd><p>Live2D displayables may created multiple Models when rendered, generally
one Model for each layer.</p>
</dd>
<dt><a class="reference internal" href="transforms.html#Transform" title="Transform"><code class="xref py py-func docutils literal notranslate"><span class="pre">Transform()</span></code></a> and ATL</dt><dd><p>A Transform creates a model if <a class="reference internal" href="#transform-property-mesh"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">mesh</span></code></a> is True, or if <a class="reference internal" href="transform_properties.html#transform-property-blur"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">blur</span></code></a>
is being used. In this case, the children of the Transform are rendered
to textures, with the mesh of the first texture being used for the mesh
associated with the model.</p>
<p>Not every transform creates a Model. Some transforms will simply add
shaders and uniforms to a Render (such as transforms that use
<a class="reference internal" href="transform_properties.html#transform-property-blur"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">blur</span></code></a> or <a class="reference internal" href="transform_properties.html#transform-property-alpha"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">alpha</span></code></a>). Other transforms simply affect
geometry.</p>
</dd>
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">Render</span></code></dt><dd><p>A Transform creates a model if its <code class="docutils literal notranslate"><span class="pre">mesh</span></code> attribute is True.
In this case, the children of the Render are rendered to
textures, with the mesh of the first texture being used for
the mesh associated with the model.</p>
</dd>
</dl>
<p>It's expected that Ren'Py will add more ways of creating models in the
future.</p>
</section>
<section id="shader-program-generation">
<h2>Shader Program Generation<a class="headerlink" href="#shader-program-generation" title="Link to this heading"></a></h2>
<p>Ren'Py generates a shader program by first assembling a list of shader part
names. This list consists of &quot;renpy.geometry&quot;, the list of shader parts
taken from Renders, and the list of shader parts found in the Model being
drawn.</p>
<p>The shader parts are then deduplicated. If a shader part begins with &quot;-&quot;,
it is removed from the list, as is the rest of that part without the
leading &quot;-&quot;. (So &quot;-renpy.geometry&quot; will cause itself and &quot;renpy.geometry&quot;
to be removed.)</p>
<p>Ren'Py then takes the list of shader parts, and retrieves lists of variables,
functions, vertex shader parts, and fragment shader parts. These are, in turn,
used to generate the source code for shaders, with the parts of the vertex and
fragment shaders being included in low-number to high-number priority order.</p>
<p>This means that any variable created by one of the shaders will be accessible
by every other fragment from any other shader in the list of shader parts.
There is no scope like in Python functions to protect interference between
shaders.</p>
<p>Ren'Py keeps a cache of all combinations of shader parts that have ever been
used in game/cache/shaders.txt, and loads them at startup. If major changes
in shader use occur, this file should be edited or deleted so it can be
re-created with valid data.</p>
</section>
<section id="creating-a-custom-shader">
<span id="custom-shaders"></span><h2>Creating a Custom Shader<a class="headerlink" href="#creating-a-custom-shader" title="Link to this heading"></a></h2>
<p>New shader parts can be created by calling the renpy.register_shader
function and supplying portions of GLSL shaders.</p>
<p>Generally, shader parts should be of the form &quot;namespace.part&quot;, such as
&quot;mygame.recolor&quot; or &quot;mylibrary.warp&quot;. Names beginning with &quot;renpy.&quot; or
&quot;live2d.&quot; are reserved for Ren'Py, as are names beginning with _.</p>
<dl class="py function">
<dt class="sig sig-object py" id="renpy.register_shader">
<span class="sig-prename descclassname"><span class="pre">renpy.</span></span><span class="sig-name descname"><span class="pre">register_shader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#renpy.register_shader" title="Link to this definition"></a></dt>
<dd><p>This registers a shader part. This takes <cite>name</cite>, and then
keyword arguments.</p>
<dl>
<dt><cite>name</cite></dt><dd><p>A string giving the name of the shader part. Names starting with an
underscore or &quot;renpy.&quot; are reserved for Ren'Py.</p>
</dd>
<dt><cite>variables</cite></dt><dd><p>The variables used by the shader part. These should be listed one per
line, a storage (uniform, attribute, or varying) followed by a type,
name, and semicolon. For example:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="n">variables</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">uniform sampler2D tex0;</span>
<span class="s1">attribute vec2 a_tex_coord;</span>
<span class="s1">varying vec2 v_tex_coord;</span>
<span class="s1">&#39;&#39;&#39;</span>
</pre></div>
</div>
</dd>
<dt><cite>vertex_functions</cite></dt><dd><p>If given, a string containing functions that will be included in the
vertex shader.</p>
</dd>
<dt><cite>fragment_functions</cite></dt><dd><p>If given, a string containing functions that will be included in the
fragment shader.</p>
</dd>
</dl>
<p>Other keyword arguments should start with <code class="docutils literal notranslate"><span class="pre">vertex_</span></code> or <code class="docutils literal notranslate"><span class="pre">fragment_</span></code>,
and end with an integer priority. So &quot;fragment_200&quot; or &quot;vertex_300&quot;. These
give text that's placed in the appropriate shader at the given priority,
with lower priority numbers inserted before higher priority numbers.</p>
</dd></dl>

<p>Ren'Py supports only the following variable types:</p>
<ul class="simple">
<li><p>float (a Python float)</p></li>
<li><p>vec2 (a tuple of 2 floats)</p></li>
<li><p>vec3 (a tuple of 3 floats)</p></li>
<li><p>vec4 (a tuple of 4 floats)</p></li>
<li><p>int (a Python integer)</p></li>
<li><p>ivec2 (a tuple of 2 integers)</p></li>
<li><p>ivec3 (a tuple of 3 integers)</p></li>
<li><p>ivec4 (a tuple of 4 integers)</p></li>
<li><p>bool (a Python boolean)</p></li>
<li><p>bvec2 (a tuple of 2 booleans)</p></li>
<li><p>bvec3 (a tuple of 3 booleans)</p></li>
<li><p>bvec4 (a tuple of 4 booleans)</p></li>
<li><p>type[n] (an array of [n] elements of [type] (any of the types above) (for instance, int[5] would be an array of 5 integers))</p></li>
<li><p>mat2 (a <a class="reference internal" href="matrix.html#Matrix" title="Matrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">Matrix</span></code></a>)</p></li>
<li><p>mat3 (a <a class="reference internal" href="matrix.html#Matrix" title="Matrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">Matrix</span></code></a>)</p></li>
<li><p>mat4 (a <a class="reference internal" href="matrix.html#Matrix" title="Matrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">Matrix</span></code></a>)</p></li>
<li><p>sampler2D (a Displayabe, including strings that give Displayables, or a Render)</p></li>
</ul>
<p>Uniform variables should begin with u_, attributes with a_, and varying
variables with v_. Names starting with u_renpy_, a_renpy, and v_renpy
are reserved, as are the standard variables given below.</p>
<p>As a general sketch for priority levels, priority 100 sets up geometry,
priority 200 determines the initial fragment color (gl_FragColor), and
higher-numbered priorities can apply effects to alter that color.</p>
<p>Here's an example of a custom shader part that applies a gradient across
each model it is used to render:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="k">init</span> <span class="k">python</span><span class="p">:</span>

    <span class="n">renpy</span><span class="o">.</span><span class="n">register_shader</span><span class="p">(</span><span class="s2">&quot;example.gradient&quot;</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        uniform vec4 u_gradient_left;</span>
<span class="s2">        uniform vec4 u_gradient_right;</span>
<span class="s2">        uniform vec2 u_model_size;</span>
<span class="s2">        varying float v_gradient_done;</span>
<span class="s2">        attribute vec4 a_position;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">vertex_300</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        v_gradient_done = a_position.x / u_model_size.x;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">fragment_300</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        float gradient_done = v_gradient_done;</span>
<span class="s2">        gl_FragColor *= mix(u_gradient_left, u_gradient_right, gradient_done);</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The custom shader can then be applied using a transform:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="k">transform</span> <span class="n">gradient</span><span class="p">:</span>
    <span class="na">shader</span> <span class="s2">&quot;example.gradient&quot;</span>
    <span class="n">u_gradient_left</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">u_gradient_right</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="k">show</span> <span class="n">eileen</span> <span class="n">happy</span> <span class="k">at</span> <span class="n">gradient</span>
</pre></div>
</div>
<p>As stated before, the <code class="docutils literal notranslate"><span class="pre">gradient_done</span></code> variable from the example.gradient shader
will be accessible by any and all other shaders applied from the same list. This
can be useful when having optional parts in a given shader system, but it can also
lead to name collisions when using two independent shaders.</p>
<p><strong>GLSL Version.</strong>
The version of GLSL supported depends on platform, but the most restrictive
are mobile and web platforms, which use GLSL ES 1.00. Ren'Py declares variables
to have highp precision, which supports floating point numbers in the range
2<sup>-62</sup> to 2<sup>62</sup>. Non-zero floating point numbers should have a
magnitude betwee 2<sup>-62</sup> and 2<sup>62</sup>, and integers should be in the range
range -2<sup>16</sup> to 2<sup>16</sup>.  Actual hardware often supports a larger range,
but this isn't guaranteed.</p>
<p>There is a variable that can help in debugging custom shaders:</p>
<dl class="std var">
<dt class="sig sig-object std" id="var-config.log_gl_shaders">
<span class="pre">define</span> <span class="sig-name descname"><span class="pre">config.log_gl_shaders</span></span> <span class="pre">=</span> <span class="pre">False</span><a class="headerlink" href="#var-config.log_gl_shaders" title="Link to this definition"></a></dt>
<dd><p>If true, source code for the GLSL shader programs will be written to
log.txt on start.</p>
</dd></dl>

</section>
<section id="shader-part-local-variables">
<span id="shader-local-variables"></span><h2>Shader Part Local Variables<a class="headerlink" href="#shader-part-local-variables" title="Link to this heading"></a></h2>
<p>Variables can be declared shader-local by using one of <code class="docutils literal notranslate"><span class="pre">u__</span></code>, <code class="docutils literal notranslate"><span class="pre">a__</span></code>,
<code class="docutils literal notranslate"><span class="pre">v__</span></code>, or <code class="docutils literal notranslate"><span class="pre">l__</span></code> as a prefix. When this is done, the double underscores
are filled in with the shader name with all dots replaced with underscores.
For example, if the shader name is <code class="docutils literal notranslate"><span class="pre">example.gradient</span></code>, the prefix
<code class="docutils literal notranslate"><span class="pre">u__</span></code> will be replaced with <code class="docutils literal notranslate"><span class="pre">u_example_gradient_</span></code>.</p>
<p>The main use of this is with <a class="reference internal" href="textshaders.html"><span class="doc">text shaders</span></a>, where most
uniforms are shader-local. Also, local variables inside the shader should
be declared with <code class="docutils literal notranslate"><span class="pre">l__</span></code>.</p>
</section>
<section id="transforms-and-model-based-rendering">
<h2>Transforms and Model-Based Rendering<a class="headerlink" href="#transforms-and-model-based-rendering" title="Link to this heading"></a></h2>
<p>Model-Based rendering adds the following properties to ATL and <a class="reference internal" href="transforms.html#Transform" title="Transform"><code class="xref py py-func docutils literal notranslate"><span class="pre">Transform()</span></code></a>:</p>
<dl class="std transform-property">
<dt class="sig sig-object std" id="transform-property-mesh">
<span class="sig-name descname"><span class="pre">mesh</span></span><a class="headerlink" href="#transform-property-mesh" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None or True or tuple</p>
</dd>
<dt class="field-even">Default<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p>If not None, this Transform will be rendered as a model. This means:</p>
<ul class="simple">
<li><p>A mesh will be created. If this is a 2-component tuple, it's taken
as the number of points in the mesh, in the x and y directions. (Each
dimension must be at least 2.) If True, the mesh is taken from the
child.</p></li>
<li><p>The child of this transform will be rendered to a texture.</p></li>
<li><p>The renpy.texture shader will be added.</p></li>
</ul>
<p>By default, the texture used by the mesh will not be mipmapped. If
mipmaps are desired, <code class="xref std std-tpref docutils literal notranslate"><span class="pre">gl_mipmap</span></code> should be set to True.</p>
</dd></dl>

<dl class="std transform-property">
<dt class="sig sig-object std" id="transform-property-mesh_pad">
<span class="sig-name descname"><span class="pre">mesh_pad</span></span><a class="headerlink" href="#transform-property-mesh_pad" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None or tuple</p>
</dd>
<dt class="field-even">Default<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p>If not None, this can either be a 2 or 4-component tuple. If mesh is
True and this is given, this applies padding to the size of the textures
applied to the textures used by the mesh. A 2-component tuple applies
padding to the right and bottom, while a 4-component tuple applies
padding to the left, top, right, and bottom.</p>
<p>This can be used, in conjunction with the <code class="docutils literal notranslate"><span class="pre">gl_pixel_perfect</span></code> property,
to render text into a mesh. In Ren'Py, text is rendered at the screen
resolution, which might overflow the boundaries of the texture that
will be applied to the mesh. Adding a few pixels of padding makes the
texture bigger, which will display all pixels. For example:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="k">transform</span> <span class="n">adjust_text</span><span class="p">:</span>
    <span class="na">mesh</span> <span class="kc">True</span>
    <span class="na">mesh_pad</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="na">gl_pixel_perfect</span> <span class="kc">True</span>
    <span class="na">shader</span> <span class="s2">&quot;shaders.adjust_text&quot;</span>
</pre></div>
</div>
<p>will ensure that the texture passed to the shader contains all of the pixels
of the text.</p>
</dd></dl>

<dl class="std transform-property">
<dt class="sig sig-object std" id="transform-property-shader">
<span class="sig-name descname"><span class="pre">shader</span></span><a class="headerlink" href="#transform-property-shader" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None or str or list of str</p>
</dd>
<dt class="field-even">Default<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p>If not None, a shader part name or list of shader part names that will be
applied to this Render (if a Model is created) or the Models reached
through this Render.</p>
</dd></dl>

<dl class="std transform-property">
<dt class="sig sig-object std" id="transform-property-blend">
<span class="sig-name descname"><span class="pre">blend</span></span><a class="headerlink" href="#transform-property-blend" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None or str</p>
</dd>
<dt class="field-even">Default<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p>if not None, this should be a string. This string is looked up in
<a class="reference internal" href="#var-config.gl_blend_func"><code class="xref std std-var docutils literal notranslate"><span class="pre">config.gl_blend_func</span></code></a> to get the value for the gl_blend_func
property. It's used to use alternate blend modes.</p>
<p>The default blend modes this supports are &quot;normal&quot;, &quot;add&quot;, &quot;multiply&quot;,
&quot;min&quot;, and &quot;max&quot;.</p>
</dd></dl>

<p>In addition, uniforms that start with u_ but not with u_renpy are made available
as Transform properties. GL properties are made available as transform
properties starting with gl_. For example, the color_mask property is made
available as gl_color_mask.</p>
</section>
<section id="blend-functions">
<h2>Blend Functions<a class="headerlink" href="#blend-functions" title="Link to this heading"></a></h2>
<dl class="std var">
<dt class="sig sig-object std" id="var-config.gl_blend_func">
<span class="pre">define</span> <span class="sig-name descname"><span class="pre">config.gl_blend_func</span></span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span><a class="headerlink" href="#var-config.gl_blend_func" title="Link to this definition"></a></dt>
<dd><p>A dictionary used to map a blend mode name to a blend function. The
blend modes are supplied to the <a class="reference internal" href="#gl-blend-func"><span class="std std-ref">gl_blend_func</span></a> property, given below.</p>
</dd></dl>

<p>The default blend modes are:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="na">gl_blend_func</span><span class="p">[</span><span class="s2">&quot;normal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">GL_FUNC_ADD</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">,</span> <span class="n">GL_FUNC_ADD</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">)</span>
<span class="na">gl_blend_func</span><span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">GL_FUNC_ADD</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_FUNC_ADD</span><span class="p">,</span> <span class="n">GL_ZERO</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">)</span>
<span class="na">gl_blend_func</span><span class="p">[</span><span class="s2">&quot;multiply&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">GL_FUNC_ADD</span><span class="p">,</span> <span class="n">GL_DST_COLOR</span><span class="p">,</span> <span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">,</span> <span class="n">GL_FUNC_ADD</span><span class="p">,</span> <span class="n">GL_ZERO</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">)</span>
<span class="na">gl_blend_func</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">GL_MIN</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_MIN</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">)</span>
<span class="na">gl_blend_func</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">GL_MAX</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_MAX</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">)</span>
</pre></div>
</div>
<p>As Ren'Py uses premultiplied alpha, the results of some of these may be counterintuitive when a pixel
is not opaque. In the GPU, the color (r, g, b, a) is represented as (r * a, g * a, b * a, a), and the blend function
uses these premultiplied colors. This may be a different result that you get for these blend modes in a paint program,
when what is drawn is not fully opaque.</p>
</section>
<section id="float-sample-and-vector-uniforms">
<span id="model-uniforms"></span><h2>Float, Sample, and Vector Uniforms<a class="headerlink" href="#float-sample-and-vector-uniforms" title="Link to this heading"></a></h2>
<p>The following uniforms are made available to all models.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">vec2</span> <span class="pre">u_model_size</span></code></dt><dd><p>The width and height of the model, as supplied to Ren'Py. This
is only available for 2D models that supply a size, and is (0, 0)
for 3d models.</p>
</dd>
</dl>
<dl class="simple" id="u-lod-bias">
<dt><code class="docutils literal notranslate"><span class="pre">float</span> <span class="pre">u_lod_bias</span></code></dt><dd><p>The level of detail bias to apply to texture lookups. This may be
set in a Transform. The default value, taken from <a class="reference internal" href="config.html#var-config.gl_lod_bias"><code class="xref std std-var docutils literal notranslate"><span class="pre">config.gl_lod_bias</span></code></a>
and defaulting to -0.5, biases Ren'Py to always pick the next bigger
level and scale it down.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">float</span> <span class="pre">u_time</span></code></dt><dd><p>The time of the frame. The epoch is undefined, so it's best to treat
this as a number that increases by one second a second. The time is
modulo 86400, so it will reset to 0.0 once a day.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vec4</span> <span class="pre">u_random</span></code></dt><dd><p>Four random numbers between 0.0 and 1.0 that are (with incredibly high
likelyhood) different from frame to frame.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vec4</span> <span class="pre">u_viewport</span></code></dt><dd><p>This gives the current viewport being drawn into. u_viewport.xy is
are the coordinates of the bottom-left corner of the viewport, relative
to the bottom-left corner of the window. u_viewport.pq is the width
and height of the viewport.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">vec2</span> <span class="pre">u_virtual_size</span></code></p>
<blockquote>
<div><p>This is the virtual size of the game (<a class="reference internal" href="config.html#var-config.screen_width"><code class="xref std std-var docutils literal notranslate"><span class="pre">config.screen_width</span></code></a>, <a class="reference internal" href="config.html#var-config.screen_height"><code class="xref std std-var docutils literal notranslate"><span class="pre">config.screen_height</span></code></a>).
This can be used to convert from gl_Position to virtual coordinates using:</p>
<div class="highlight-glsl notranslate"><div class="highlight"><pre><span></span><span class="n">v_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_virtual_size</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="nb">gl_Position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">.5</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="nb">gl_Position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">.5</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">vec2</span> <span class="pre">u_drawable_size</span></code></dt><dd><p>The size of the drawable are of the windows, in pixels, at the resolution
the game is running at. For example, if a 1280x720 game is scaled up to
1980x1080, this will be (1920, 1080).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sampler2D</span> <span class="pre">tex0</span></code>, <code class="docutils literal notranslate"><span class="pre">sampler2D</span> <span class="pre">tex1</span></code>, <code class="docutils literal notranslate"><span class="pre">sampler2D</span> <span class="pre">tex2</span></code></dt><dd><p>If textures are available, the corresponding samplers are placed in
this variable.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vec2</span> <span class="pre">res0</span></code>, <code class="docutils literal notranslate"><span class="pre">vec2</span> <span class="pre">res1</span></code>, <code class="docutils literal notranslate"><span class="pre">vec2</span> <span class="pre">res2</span></code></dt><dd><p>If textures are available, the size of the textures are placed in these
variables. When the texture is loaded from disk, this is the size of the
image file. After a render to texture, it's the number of drawable pixels
the rendered texture covered.</p>
</dd>
</dl>
<p>If a sampler uniform is available, then suffixing it with <code class="docutils literal notranslate"><span class="pre">__res</span></code> will give a vec2
containing the underlying texture size. For example, <code class="docutils literal notranslate"><span class="pre">u_markup__res</span></code> will give the size of the
<code class="docutils literal notranslate"><span class="pre">u_markup</span></code> texture.</p>
<p>If a vec4 uniform is available, then suffixing it with <code class="docutils literal notranslate"><span class="pre">__premul</span></code> will give a vec4
containing the premultiplied color. For example, <code class="docutils literal notranslate"><span class="pre">u_color__premul</span></code> will give a vec4
where the red, green, and blue channels are multiplied by the alpha channel.</p>
</section>
<section id="matrix-uniforms">
<h2>Matrix Uniforms<a class="headerlink" href="#matrix-uniforms" title="Link to this heading"></a></h2>
<p>The following uniforms are made available to all models. This assumes that only one transform with the
<a class="reference internal" href="3dstage.html#transform-property-perspective"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">perspective</span></code></a> property is used to render a model. When multiple transforms with the <a class="reference internal" href="3dstage.html#transform-property-perspective"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">perspective</span></code></a>
are used, the innermost transformation with perspective set defines the world and view spaces.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mat4</span> <span class="pre">u_projection</span></code></dt><dd><p>This is a matrix that transforms coordinates from view space to the OpenGL viewport.
This is sent by Ren'Py, and is updated by transforms with the <a class="reference internal" href="3dstage.html#transform-property-perspective"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">perspective</span></code></a> property
to encapsulate the effects of that property.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mat4</span> <span class="pre">u_view</span></code></dt><dd><p>This is a matrix that transforms vertex coordinates from the world space to the view space. This
defaults to the identity matrix, but can be set by transforms with the <a class="reference internal" href="3dstage.html#transform-property-perspective"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">perspective</span></code></a> property,
in which case the effects of positioning, rotation, and scaling are encapsulated in this matrix.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mat4</span> <span class="pre">u_model</span></code></dt><dd><p>This is a matrix that transforms vertex coordinates from the model space to the world space.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mat4</span> <span class="pre">u_projectionview</span></code></dt><dd><p>This matrix contains <code class="docutils literal notranslate"><span class="pre">u_projection</span> <span class="pre">*</span> <span class="pre">u_view</span></code>. It exists to minimize the number of uniforms that need
to be sent to the GPU, and the amount of work that needs to be done in the shader.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mat4</span> <span class="pre">u_transform</span></code></dt><dd><p>This is the same as <code class="docutils literal notranslate"><span class="pre">u_projectionview</span> <span class="pre">*</span> <span class="pre">u_model</span></code>. It's the matrix that transforms vertex coordinates
directly to the OpenGL viewport. It exists to minimize the number of uniforms that need to be sent to the GPU,
the amount of work that needs to be done in the shader, and for compatibility with older versions of Ren'Py.</p>
</dd>
</dl>
<p>In addition to these methods, Ren'Py can synthesize matrices with certain functions applied when suffixes are
appended to the matrix</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">__inverse</span></code></dt><dd><p>When appended to a matrix, this returns the inverse of the matrix. For example, <code class="docutils literal notranslate"><span class="pre">u_projection__inverse</span></code>
is the inverse of the projection matrix.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__transpose</span></code></dt><dd><p>When appended to a matrix, this returns the transpose of the matrix. For example, <code class="docutils literal notranslate"><span class="pre">u_view__transpose</span></code>
is the transpose of the view matrix.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__inverse_transpose</span></code></dt><dd><p>When appended to a matrix, this returns the inverse of the transpose of the matrix. For example,
<code class="docutils literal notranslate"><span class="pre">u_model__inverse_transpose</span></code> is the inverse of the transpose of the model matrix. This is useful for
transforming normals.</p>
</dd>
</dl>
</section>
<section id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Link to this heading"></a></h2>
<p>The following attribute is available to all models:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">vec4</span> <span class="pre">a_position</span></code></dt><dd><p>The position of the vertex being rendered. This is in virtual pixels, relative to the upper
left corner of the texture.</p>
</dd>
</dl>
<p>If textures are available, so is the following attribute:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">vec2</span> <span class="pre">a_tex_coord</span></code></dt><dd><p>The coordinate that this vertex projects to inside the textures.</p>
</dd>
</dl>
<p>If normals are available, so is the following attribute:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">vec3</span> <span class="pre">a_normal</span></code></dt><dd><p>The normal of the vertex being rendered.</p>
</dd>
</dl>
<p>If tangents are available, so are the following attributes:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">vec3</span> <span class="pre">a_tangent</span></code></dt><dd><p>The tangent of the vertex being rendered.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vec3</span> <span class="pre">a_bitangent</span></code></dt><dd><p>The bitangent of the vertex being rendered.</p>
</dd>
</dl>
</section>
<section id="gl-properties">
<span id="id1"></span><h2>GL Properties<a class="headerlink" href="#gl-properties" title="Link to this heading"></a></h2>
<p>GL properties change the global state of OpenGL, or the Model-Based renderer.
These properties can be used with a Transform, or with the <code class="xref py py-func docutils literal notranslate"><span class="pre">Render.add_property()</span></code>
function.</p>
<dl id="gl-blend-func">
<dt><code class="docutils literal notranslate"><span class="pre">gl_blend_func</span></code></dt><dd><p>If present, this is expected to be a six-component tuple, which is
used to set the equation used to blend the pixel being drawn with the
pixel it is being drawn to, and the parameters to that equation.</p>
<p>Specifically, this should be (<cite>rgb_equation</cite>, <cite>src_rgb</cite>, <cite>dst_rgb</cite>,
<cite>alpha_equation</cite>, <cite>src_alpha</cite>, <cite>dst_alpha</cite>). These will be used to
call:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="n">glBlendEquationSeparate</span><span class="p">(</span><span class="n">rgb_equation</span><span class="p">,</span> <span class="n">alpha_equation</span><span class="p">)</span>
<span class="n">glBlendFuncSeparate</span><span class="p">(</span><span class="n">src_rgb</span><span class="p">,</span> <span class="n">dst_rgb</span><span class="p">,</span> <span class="n">src_alpha</span><span class="p">,</span> <span class="n">dst_alpha</span><span class="p">)</span>
</pre></div>
</div>
<p>Please see the OpenGL documentation for what these functions do.
OpenGL constants can be imported from renpy.uguu:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="k">init</span> <span class="k">python</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">renpy.uguu</span> <span class="kn">import</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_ONE_MINUS_SRC_ALPHA</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#transform-property-blend"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">blend</span></code></a> transform property is generally an easy way to
use this.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gl_color_mask</span></code></dt><dd><p>This is expecting to be a 4-tuple of booleans, corresponding to the four
channels of a pixel (red, green, blue, and alpha). If a given channel is
True, the draw operation will write to that pixel. Otherwise, it will
not.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gl_cull_face</span></code></dt><dd><p>If not None, this enables face culling, which is the process of removing
triangles that are facing away from the camera. To do this, we need to
know which face is the front face, and which is the back face. The front face
is determined using the winding order of the vertices, which is one of &quot;cw&quot; (clockwise) or &quot;ccw&quot; (counter-clockwise).
The values are done in the Ren'Py coordinate system (with +Y down), which is the opposite of the OpenGL coordinate system.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gl_depth</span></code></dt><dd><p>If True, this will clear the depth buffer, and then enable depth
rendering for this displayable and the children of this displayable.</p>
<p>Note that drawing any pixel, even transparent pixels, will update
the depth buffer. As a result, using this with images that have
transparency may lead to unexpected problems. (As an alternative,
consider the <code class="docutils literal notranslate"><span class="pre">zorder</span></code> and <code class="docutils literal notranslate"><span class="pre">behind</span></code> clauses of the <code class="docutils literal notranslate"><span class="pre">show</span></code> statement.)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gl_pixel_perfect</span></code></dt><dd><p>When True, Ren'Py will move the mesh such that the first vertex is aligned with
a pixel on the screen. This is mostly used in conjunction with text,
to ensure that the text remains sharp.</p>
</dd>
</dl>
<p>The following properties only take effect when a texture is being created,
by a Transform with <a class="reference internal" href="#transform-property-mesh"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">mesh</span></code></a> set, or by <a class="reference internal" href="#Model" title="Model"><code class="xref py py-func docutils literal notranslate"><span class="pre">Model()</span></code></a>, where these
can be supplied the property method.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">gl_drawable_resolution</span></code></dt><dd><p>If True or not set, the texture is rendered at the same resolution
as the window displaying the game. If False, it's rendered at the
virtual resolution of the displayable.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gl_anisotropic</span></code></dt><dd><p>If supplied, this determines if the textures applied to a mesh are
created with anisotropy. Anisotropy is a feature that causes multiple
texels (texture pixels) to be sampled when a texture is zoomed by a
different amount in X and Y.</p>
<p>This defaults to True. Ren'Py sets this to False for certain effects,
like the Pixellate transition.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gl_mipmap</span></code></dt><dd><p>If supplied, this determines if the textures supplied to a mesh are
created with mipmaps. This defaults to True.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gl_texture_wrap</span></code></dt><dd><p>When supplied, this determines how the textures applied to a mesh
are wrapped. This expects a 2-component tuple, where the first
component is used to set GL_TEXTURE_WRAP_S and the second component
is used to set GL_TEXTURE_WRAP_T, which conventionally are the X and Y
axes of the created texture.</p>
<p>The values should be OpenGL constants imported from renpy.uguu:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="k">init</span> <span class="k">python</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">renpy.uguu</span> <span class="kn">import</span> <span class="n">GL_CLAMP_TO_EDGE</span><span class="p">,</span> <span class="n">GL_MIRRORED_REPEAT</span><span class="p">,</span> <span class="n">GL_REPEAT</span>
</pre></div>
</div>
<p>This can also be customized for specific textures. <cite>gl_texture_wrap_tex0</cite> controls
the first texture, <cite>gl_texture_wrap_tex1</cite> the second, <cite>gl_texture_wrap_tex2</cite>, the third,
and <cite>gl_texture_wrap_tex3</cite> the fourth. While only these four are avalable through Transforms,
it's possibe to supply &quot;texture_wrap_tex4&quot; or &quot;texture_wrap_myuniform&quot; to Render.add_property.</p>
</dd>
</dl>
</section>
<section id="gltfmodel-displayable">
<h2>GLTFModel Displayable<a class="headerlink" href="#gltfmodel-displayable" title="Link to this heading"></a></h2>
<p>The GLTFModel displayble allow you to load 3D models in the GLTF file format. This is what you should use
if you have a 3D model you created in another program and want to display in Ren'Py.</p>
<dl class="py class">
<dt class="sig sig-object py" id="GLTFModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">GLTFModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'str'</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shader</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'str</span> <span class="pre">|</span> <span class="pre">tuple[str]'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tangents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'bool'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zoom</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'float'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">report</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'bool'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#GLTFModel" title="Link to this definition"></a></dt>
<dd><p>A displayable that loads a 3D Model in the GLTF format. This format is supported by many 3D tools. Ren'Py
uses the <a class="reference external" href="https://github.com/assimp/assimp">Open Asset Importer (assimp) library</a> to load GLTF models.</p>
<p>For the purposes of Ren'Py's 2D layout system, a GLTFModel has zero width and height. By default, the model
is loaded at the size found in the file that contains it. If required, the <cite>zoom</cite> may be used to scale it.</p>
<p>When multiple models are in use, the <code class="docutils literal notranslate"><span class="pre">gl_depth</span> <span class="pre">True</span></code> property should be supplied to the camera, so that
depth testing is enabled. Ren'Py does not currently perform any culling of the model, so it's
important to use models simple enough to be completely rendered.</p>
<dl class="simple">
<dt><cite>filename</cite></dt><dd><p>The filename of the model to display.</p>
</dd>
<dt><cite>shader</cite></dt><dd><p>Either a string or tuple of strings, giving the name of the shader to use.</p>
</dd>
<dt><cite>tangents</cite></dt><dd><p>If True, tangents will be included in the mesh.</p>
</dd>
<dt><cite>zoom</cite></dt><dd><p>A zoom factor that will be applied to the model. Many models naturally use the range -1 to 1, and so this
may need to be quite large to make the model visible.</p>
</dd>
<dt><cite>report</cite></dt><dd><p>If true, a report of the model will be printed to the log. This includes the uniforms that are used by
the model.</p>
</dd>
</dl>
<p>A displayable that loads a 3D Model in the GLTF format. This format is supported by many 3D tools. Ren'Py
uses the <a class="reference external" href="https://github.com/assimp/assimp">Open Asset Importer (assimp) library</a> to load GLTF models.</p>
<p>For the purposes of Ren'Py's 2D layout system, a GLTFModel has zero width and height. By default, the model
is loaded at the size found in the file that contains it. If required, the <cite>zoom</cite> may be used to scale it.</p>
<p>When multiple models are in use, the <code class="docutils literal notranslate"><span class="pre">gl_depth</span> <span class="pre">True</span></code> property should be supplied to the camera, so that
depth testing is enabled. Ren'Py does not currently perform any culling of the model, so it's
important to use models simple enough to be completely rendered.</p>
<dl class="simple">
<dt><cite>filename</cite></dt><dd><p>The filename of the model to display.</p>
</dd>
<dt><cite>shader</cite></dt><dd><p>Either a string or tuple of strings, giving the name of the shader to use.</p>
</dd>
<dt><cite>tangents</cite></dt><dd><p>If True, tangents will be included in the mesh.</p>
</dd>
<dt><cite>zoom</cite></dt><dd><p>A zoom factor that will be applied to the model. Many models naturally use the range -1 to 1, and so this
may need to be quite large to make the model visible.</p>
</dd>
<dt><cite>report</cite></dt><dd><p>If true, a report of the model will be printed to the log. This includes the uniforms that are used by
the model.</p>
</dd>
</dl>
</dd></dl>

<p>Some things we noticed:</p>
<ul class="simple">
<li><p>Some models are very small, and need to be zoomed by 100x or 1000x to be useful.</p></li>
<li><p>The uniforms generating by each model can vary.</p></li>
</ul>
<p>We recommend creating GLTF models with report=True, and then looking at log.txt to see
the size and  what's available. It's then possible to scale the model and to
create a suitable shader.</p>
<section id="limitations">
<h3>Limitations<a class="headerlink" href="#limitations" title="Link to this heading"></a></h3>
<p>GLTFModel currently does not include a default shader, so you must define and include a shader.
Here is one possible shader that can be used with GLTFModel:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="k">init</span> <span class="k">python</span><span class="p">:</span>

    <span class="n">renpy</span><span class="o">.</span><span class="n">register_shader</span><span class="p">(</span><span class="s2">&quot;example.lighting&quot;</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        uniform mat4 u_model__inverse_transpose;</span>
<span class="s2">        uniform vec4 u_color_diffuse;</span>
<span class="s2">        uniform vec4 u_color_specular;</span>
<span class="s2">        uniform sampler2D u_tex_diffuse;</span>

<span class="s2">        varying vec3 v_normal;</span>
<span class="s2">        varying vec2 v_tex_coord;</span>

<span class="s2">        attribute vec3 a_normal;</span>
<span class="s2">        attribute vec2 a_tex_coord;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">vertex_201</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        v_normal = (u_model__inverse_transpose * vec4(a_normal, 1.0)).xyz;</span>
<span class="s2">        v_tex_coord = a_tex_coord;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">fragment_201</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        // The direction of the light.</span>
<span class="s2">        vec3 lightDir = normalize(vec3(0.0, -1000.0, 1000.0));</span>

<span class="s2">        vec3 normal = normalize(v_normal);</span>

<span class="s2">        float lambertian = max(dot(normal, lightDir), 0.0);</span>
<span class="s2">        vec4 diffuse_color = texture2D(u_tex_diffuse, v_tex_coord.xy);</span>
<span class="s2">        diffuse_color *= vec4(lambertian * u_color_diffuse.rgb * u_color_diffuse.a, u_color_diffuse.a);</span>

<span class="s2">        vec3 viewDir = normalize(vec3(0.0, 0.0, -1.0));</span>
<span class="s2">        vec3 halfDir = normalize(lightDir + viewDir);</span>
<span class="s2">        float specular = pow(max(dot(normal, halfDir), 0.0), 4.0);</span>

<span class="s2">        vec4 specular_color = vec4(u_color_specular.rgb * u_color_specular.a * specular, u_color_specular.a * specular);</span>

<span class="s2">        gl_FragColor = diffuse_color + specular_color;</span>

<span class="s2">        if (gl_FragColor.a &lt; 0.9) {</span>
<span class="s2">            discard;</span>
<span class="s2">        }</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a very simple shader that applies diffuse and specular lighting to the model based
on a single light source, meant for experimentation until better shaders are created.</p>
<p>GLTFModel does not support transparent surfaces well. While the discard command above emulates
transparency, the ordering is a bit wrong and can lead to artifacts.</p>
</section>
</section>
<section id="model-displayable">
<h2>Model Displayable<a class="headerlink" href="#model-displayable" title="Link to this heading"></a></h2>
<p>The Model displayable acts as a factory to created models for use with the
model-based renderer. This is an older API you may wish to use when you want to create
models in Python.</p>
<dl class="py class">
<dt class="sig sig-object py" id="Model">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">properties</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Model" title="Link to this definition"></a></dt>
<dd><p>This is a displayable that causes Ren'Py to create a 2D or 3D model
for use with the model-based renderer, that will be drawn in a single
operation with the shaders given here, or selected by an enclosing
Transform or Displayable.</p>
<dl class="simple">
<dt><cite>size</cite></dt><dd><p>If not None, this should be a width, height tuple, that's used to
give the size of the Model. If not given, the model is the size
of the area provided to it. The fit parameter to a texture takes
precedence.</p>
</dd>
</dl>
<p>If no mesh method is called, a mesh that sets a_position and a_tex_coord
to match the way Ren'Py loads textures is created if at least one texture
is supplied. Otherwise, a mesh that only sets a_position is used.</p>
<p>All methods on this calls return the displayable the method is called
on, making it possible to chain calls.</p>
<dl class="py method">
<dt class="sig sig-object py" id="Model.child">
<span class="sig-name descname"><span class="pre">child</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">displayable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Model.child" title="Link to this definition"></a></dt>
<dd><p>This is the same as the texture method, except that the <cite>focus</cite>
and <cite>main</cite> parameters are set to true.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Model.grid_mesh">
<span class="sig-name descname"><span class="pre">grid_mesh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Model.grid_mesh" title="Link to this definition"></a></dt>
<dd><p>Creates a mesh that consists of a width x height grid of evenly
spaced points, connecting each point to the closest points
vertically and horizontally, and dividing each rectangle in
the grid so created into triangles.</p>
<dl class="simple">
<dt><cite>width</cite>, <cite>height</cite></dt><dd><p>The number of points in the horizontal vertical directions,
a integer that is at least 2.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Model.property">
<span class="sig-name descname"><span class="pre">property</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Model.property" title="Link to this definition"></a></dt>
<dd><p>Sets the value of a gl property.</p>
<dl class="simple">
<dt><cite>name</cite></dt><dd><p>A string giving the name of the GL property, including the &quot;gl_&quot;
prefix.</p>
</dd>
<dt><cite>value</cite></dt><dd><p>The value of the gl property.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Model.shader">
<span class="sig-name descname"><span class="pre">shader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shader</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Model.shader" title="Link to this definition"></a></dt>
<dd><p>Adds a shader to this model.</p>
<dl class="simple">
<dt><cite>shader</cite></dt><dd><p>A string given the name of a shader to use with this model.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Model.texture">
<span class="sig-name descname"><span class="pre">texture</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">displayable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">focus</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">main</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">texture_wrap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Model.texture" title="Link to this definition"></a></dt>
<dd><p>Add a texture to this model, by rendering the given displayable.
The first texture added will be <code class="docutils literal notranslate"><span class="pre">tex0</span></code>, the second <code class="docutils literal notranslate"><span class="pre">tex1</span></code>, a
and so on.</p>
<dl class="simple">
<dt><cite>focus</cite></dt><dd><p>If true, focus events are passed to the displayable. It's
assumed that coordinate relative to the model map 1:1 with
coordinates relative to the displayable.</p>
</dd>
<dt><cite>main</cite></dt><dd><p>If true, this is marked as a main child of this displayable,
which allows it to be inspected using the displayable
inspector.</p>
</dd>
<dt><cite>fit</cite></dt><dd><p>If true, the Model is given the size of the displayable.
This may only be true for one texture.</p>
</dd>
<dt><cite>texture_wrap</cite></dt><dd><p>If not None, this is the <a class="reference internal" href="#gl-properties"><span class="std std-ref">gl_texture wrap GL property</span></a> that will be applied
to this texture.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Model.uniform">
<span class="sig-name descname"><span class="pre">uniform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Model.uniform" title="Link to this definition"></a></dt>
<dd><p>Sets the value of a uniform that is passed to the shaders.</p>
<dl class="simple">
<dt><cite>name</cite></dt><dd><p>A string giving the name of the uniform to set, including the
&quot;u_&quot; prefix.</p>
</dd>
<dt><cite>value</cite></dt><dd><p>The value of the uniform. Either a float, a 2, 3, or 4 element
tuple of floats, or a Matrix.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<section id="model-displayable-examples">
<h3>Model Displayable Examples<a class="headerlink" href="#model-displayable-examples" title="Link to this heading"></a></h3>
<p>The Model displayable can be used in conjunction with an ATL transform and
a built-in shader to create the Dissolve transform:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="k">transform</span> <span class="n">dt</span><span class="p">(</span><span class="na">delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">new_widget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">old_widget</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="na">delay</span> <span class="na">delay</span>
    <span class="n">Model</span><span class="p">()</span><span class="o">.</span><span class="n">texture</span><span class="p">(</span><span class="n">old_widget</span><span class="p">)</span><span class="o">.</span><span class="na">child</span><span class="p">(</span><span class="n">new_widget</span><span class="p">)</span>
    <span class="na">shader</span> <span class="p">[</span> <span class="s1">&#39;renpy.dissolve&#39;</span> <span class="p">]</span>

    <span class="n">u_renpy_dissolve</span> <span class="mf">0.0</span>
    <span class="n">linear</span> <span class="na">delay</span> <span class="n">u_renpy_dissolve</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>Using the Model displayable as the child of a displayable is incompatible
with <a class="reference internal" href="#transform-property-mesh"><code class="xref std std-tpref docutils literal notranslate"><span class="pre">mesh</span></code></a>, as the two both create models inside Ren'Py.</p>
</section>
</section>
<section id="animated-shaders">
<h2>Animated Shaders<a class="headerlink" href="#animated-shaders" title="Link to this heading"></a></h2>
<p>When using shaders that depend on <code class="docutils literal notranslate"><span class="pre">u_time</span></code> to animate, one must be aware,
that even though every shader on screen will run on every frame displayed,
Ren'Py does not run on constant FPS, and will fall back to the minimum frame
rate of 5 FPS if no displayables require to be redrawn.</p>
<p>When using an animating shader in an ATL transform, this can cause that shader
to &quot;stutter&quot; and only animate properly while some other object on screen
animates as well, in case the transform you're using it in does not cause
redraws otherwise. In this case, an empty ATL loop can be introduced to force
redraws to happen:</p>
<div class="highlight-renpy notranslate"><div class="highlight"><pre><span></span><span class="k">transform</span> <span class="n">fancy_shader</span><span class="p">:</span>
    <span class="na">shader</span> <span class="s1">&#39;my_fancy_shader&#39;</span>
    <span class="k">pause</span> <span class="mi">0</span>
    <span class="k">repeat</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pause</span> <span class="pre">0</span></code> will cycle the frames as fast as possible. You can also set
different values for <code class="docutils literal notranslate"><span class="pre">pause</span></code> to specify a minimum frame rate, like
<code class="docutils literal notranslate"><span class="pre">pause</span> <span class="pre">1.0/30</span></code>.</p>
</section>
<section id="shader-parts">
<h2>Shader Parts<a class="headerlink" href="#shader-parts" title="Link to this heading"></a></h2>
<p>For a list of shader parts that Ren'Py uses, see the <a class="reference internal" href="shader_parts.html"><span class="doc">Default Shader Parts</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="matrix.html" class="btn btn-neutral float-left" title="Matrix" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="other.html" class="btn btn-neutral float-right" title="Other Functions and Variables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>